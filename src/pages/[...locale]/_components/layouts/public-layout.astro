---
import { ClientRouter } from "astro:transitions";
import "@pages/_main.ts";
import "@assets/css/global.css";
import { getLangFromUrl } from "@src/i18n";

import TerminalLogo from "../terminal-logo";
import NavLinks from "../nav-links";
import NeuroPlayer from "../neuro-player";
import FloatingActionChat from "../floating-action-chat";
import { Moon } from "lucide-preact";
import { BrandIcon } from "@components/extras/brand-icon";
import { siGithub } from "simple-icons";

const lang = getLangFromUrl(Astro.url);

const {
  title = "Portfolio | Senior Developer",
  description = "Senior Full Stack Engineeer Portfolio",
} = Astro.props;
---

<!doctype html>
<html lang={lang} class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{title}</title>
    <meta name="description" content={description} />
    <ClientRouter />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700;800&family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body
    class="bg-background text-foreground antialiased selection:bg-primary/30 min-h-screen flex flex-col font-mono relative overflow-x-hidden"
  >
    <!-- Background Scanlines & Noise handled by global.css/body::after -->

    <!-- Header -->
    <header
      class="fixed top-0 left-0 right-0 z-40 bg-background/80 backdrop-blur-md border-b border-white/10 h-16 flex items-center justify-between px-6 transition-all duration-300"
    >
      <div class="flex items-center gap-8">
        <TerminalLogo />
        <div class="hidden md:block">
          <NavLinks lang={lang} client:load />
        </div>
      </div>

      <div class="flex items-center gap-4">
        <!-- Status Badge Stub -->
        <div
          class="hidden lg:flex items-center gap-2 px-3 py-1 bg-white/5 border border-white/10 rounded-full"
        >
          <span class="relative flex h-2 w-2">
            <span
              class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"
            ></span>
            <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"
            ></span>
          </span>
          <span
            class="text-[10px] text-muted-foreground font-mono tracking-wide"
            >SYSTEM_ONLINE</span
          >
        </div>

        <a
          href="https://github.com/generic-user"
          target="_blank"
          class="text-muted-foreground hover:text-white transition-colors"
        >
          <BrandIcon icon={siGithub} size={20} />
        </a>

        {
          /* Theme Toggle Stub (Visual Only as 'dark' is hardcoded/default preference for cyberpunk) */
        }
        <button
          class="text-muted-foreground hover:text-primary transition-colors"
        >
          <Moon size={20} />
        </button>
      </div>
    </header>

    <!-- Main Layout: Sidebar + Content -->
    <div class="flex pt-16 min-h-screen">
      <!-- Sidebar (Visual Placeholder / Navigation for Docs if needed, but Rules imply MusicPlayer is aside or floating) -->
      <!-- Rules: "MusicPlayer persistente en Sidebar/Aside". But NeuroPlayer implementation suggests bottom bar or floating. 
             If NeuroPlayer is fixed bottom, then Sidebar might be for inner navigation or just empty space in this specific design interpretation.
             However, let's keep it simple. The NeuroPlayer is 'fixed bottom' in the component code I read.
             So we will rely on NeuroPlayer being fixed.
        -->

      <!-- Main Content -->
      <main class="flex-1 relative pb-24">
        <slot />
      </main>
    </div>

    <!-- Footer Area (mostly visual, real footer content usually at bottom of main) -->

    <!-- Floating Components -->
    <NeuroPlayer client:load />
    <FloatingActionChat client:load />
  </body>
</html>
