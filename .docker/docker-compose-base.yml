services:
  app:
    container_name: template_app
    ports:
      - "${PORT}:${PORT}"
    environment:
      # App
      NAME_APP: ${NAME_APP}
      NODE_ENV: ${NODE_ENV}
      PORT: ${PORT}
      PUBLIC_URL: ${PUBLIC_URL}
      PUBLIC_PORT: ${PUBLIC_PORT}

      # Database
      DB_HOST: ${DB_HOST}
      DB_PORT: ${DB_PORT}
      DB_USER: ${DB_USER}
      DB_PASS: ${DB_PASS}
      DB_NAME: ${DB_NAME}
      DATABASE_URL: ${DATABASE_URL}

      # Cache (Redis/Dragonfly)
      REDIS_HOST: ${REDIS_HOST}
      REDIS_PORT: ${REDIS_PORT}
      REDIS_PASSWORD: ${REDIS_PASSWORD}

      # JWT
      JWT_KEY: ${JWT_KEY}
      JWT_EXPIRES_IN: ${JWT_EXPIRES_IN}
      JWT_REFRESH_KEY: ${JWT_REFRESH_KEY}
      JWT_REFRESH_EXPIRES_IN: ${JWT_REFRESH_EXPIRES_IN}

      # HMAC
      HMAC_KEY: ${HMAC_KEY}

      # Storage
      STORAGE_PROVIDER: ${STORAGE_PROVIDER}
      STORAGE_ACCESS_KEY: ${STORAGE_ACCESS_KEY}
      STORAGE_SECRET_KEY: ${STORAGE_SECRET_KEY}
      STORAGE_BUCKET_PUBLIC: ${STORAGE_BUCKET_PUBLIC}
      STORAGE_BUCKET_PRIVATE: ${STORAGE_BUCKET_PRIVATE}
      STORAGE_REGION: ${STORAGE_REGION}
      STORAGE_INTERNAL_ENDPOINT: ${STORAGE_INTERNAL_ENDPOINT}
      STORAGE_URL: ${STORAGE_URL}

      # Mail
      MAIL_HOST: ${MAIL_HOST}
      MAIL_PORT: ${MAIL_PORT}
      MAIL_USER: ${MAIL_USER}
      MAIL_PASS: ${MAIL_PASS}
      MAIL_FROM: ${MAIL_FROM}
      MAIL_FROM_NAME: ${MAIL_FROM_NAME}

      # Security
      CORS_ORIGINS: ${CORS_ORIGINS}
      THROTTLE_TTL: ${THROTTLE_TTL}
      THROTTLE_LIMIT: ${THROTTLE_LIMIT}
      LOG_LEVEL: ${LOG_LEVEL}

      # VAPID (Push Notifications)
      PUBLIC_VAPID_KEY: ${PUBLIC_VAPID_KEY}
      PRIVATE_VAPID_KEY: ${PRIVATE_VAPID_KEY}

      # Dev tools
      CHOKIDAR_USEPOLLING: true
      CHOKIDAR_INTERVAL: 250
    labels:
      - traefik.enable=true
      - traefik.http.routers.${NAME_APP}.rule=Host(`${PUBLIC_URL}`)
      - traefik.http.routers.${NAME_APP}.entrypoints=websecure
      - traefik.http.routers.${NAME_APP}.tls.certResolver=letsencrypt
      - traefik.http.services.${NAME_APP}.loadbalancer.server.port=${PORT}
    networks:
      - dokploy-network

networks:
  dokploy-network:
    external: true
